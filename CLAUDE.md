# Claude Code 작업 프로토콜

## 작업 흐름

각 Phase 완료 후 다음 단계를 따릅니다:

1. **구현 완료**: Phase의 모든 체크리스트 항목 구현
2. **Playwright 테스트**: MCP를 사용하여 기능 동작 검증
3. **테스트 통과 확인**: 모든 테스트 시나리오 통과 확인
4. **TASKS.md 업데이트**: 진행률 및 완료 로그 업데이트
5. **다음 Phase 진행**: 테스트 통과 후 다음 단계로 이동

## Phase별 테스트 시나리오

### Phase 3: 인증 시스템 테스트 ✅ (2025-10-21 완료)

**테스트 URL**: http://localhost:3000

**시나리오 1: 로그인 페이지 접근**
- [x] 루트 경로(/) 접근 시 /login으로 리다이렉트
- [x] 로그인 폼 UI 렌더링 확인 (아이디/비밀번호 입력란, 로그인 버튼)

**시나리오 2: 로그인 성공**
- [x] 유효한 계정으로 로그인 (admin / admin1234)
- [x] 관리자: /admin/dashboard로 리다이렉트
- [x] 일반 직원: /survey로 리다이렉트
- [x] 쿠키 설정 확인

**시나리오 3: 로그인 실패**
- [x] 잘못된 아이디/비밀번호로 로그인 시도
- [x] 에러 메시지 표시 확인: "아이디 또는 비밀번호가 올바르지 않습니다."

**시나리오 4: 인증 미들웨어**
- [x] 이미 로그인된 사용자가 /login 접근 시 /survey로 리다이렉트
- [x] 로그아웃 API 정상 작동
- [x] 로그인 후 보호된 페이지 접근 가능

**테스트 결과**: 모든 시나리오 통과 ✅

### Phase 4: 설문 시스템 테스트 (부분 완료 - 2025-10-21)

**시나리오 1: 부서/직급 선택** ✅
- [x] 부서 드롭다운 렌더링 (10개 부서, 순서 고정)
- [x] 직급 라디오 버튼 렌더링 (간부/직원)
- [x] 유효성 검증 (부서/직급 선택 필수)
- [x] 선택 후 다음 단계로 진행

**시나리오 2: 본인 소속 조직 설문** ✅
- [x] 19개 문항 렌더링 (Q2~Q20)
- [x] 평가유형별 그룹화 (조직문화 8개, 업무충실 6개, 업무협조 3개, 업무혁신 2개)
- [x] 5점척도 선택 UI 작동
- [x] 진행률 표시 (실시간 업데이트: 0% → 5% → ...)
- [x] 유효성 검증 (모든 문항 필수, 미답변 개수 표시)
- [x] API 엔드포인트 정상 작동 (/api/survey/questions?type=own-dept)

**테스트 결과 (부분)**: 시나리오 1, 2, 3 통과 ✅

**시나리오 3: 타부서 평가 (간부만)** ✅
- [x] 간부 선택 시 타부서 평가 섹션 표시
- [x] 5개 문항 × 9개 부서 테이블 렌더링 (본인 부서 자동 제외)
- [x] 평가유형별 그룹화 (업무충실 2개, 업무협조 2개, 업무혁신 1개)
- [x] 진행률 표시 (0% → 2% → ... → 100%)
- [x] 모든 셀 입력 필수 검증 (45개 셀, 미답변 개수 표시)
- [x] 이전/다음 버튼 네비게이션 작동
- [x] API 엔드포인트 정상 작동 (/api/survey/questions?type=other-dept)

**시나리오 4: 관리처 전반 설문** ✅
- [x] 22개 5점척도 문항 렌더링 (Q26-Q49, Q40/Q45 제외)
- [x] 2개 서술형 문항 렌더링 (Q40, Q45)
- [x] 평가유형별 그룹화 (조직문화 9개, 업무충실 3개, 업무협조 6개, 업무혁신 4개)
- [x] 조건부 렌더링 (Q39 답변 ≤ 2점일 때만 Q40 표시)
- [x] 진행률 표시 (5점척도만 카운트, 0% → 5% → ... → 100%)
- [x] 유효성 검증 (5점척도만 필수, 서술형 선택)
- [x] 이중 상태 관리 (scaleAnswers, textAnswers 분리)
- [x] 제출 시 두 타입 답변 모두 전달 (console 로그 확인)
- [x] API 엔드포인트 정상 작동 (/api/survey/questions?type=management)

**시나리오 5: 종합 의견** ✅
- [x] 페이지 렌더링 ("종합 의견" 타이틀)
- [x] 안내 문구 표시 ("아래 질문에 대한 의견을 자유롭게 작성해주세요. (선택사항)")
- [x] 4개 서술형 문항 렌더링 (Q50-Q53)
- [x] 모든 문항 textarea 위젯
- [x] 텍스트 입력 기능 (Q50, Q52 테스트)
- [x] 제출 버튼 클릭
- [x] Console 로그 확인 ("Opinion answers", "Final submission - All data collected")
- [x] API 엔드포인트 정상 작동 (/api/survey/questions?type=opinion)

**시나리오 6: 설문 제출** ✅
- [x] 모든 필수 항목 입력 검증
- [x] 제출 API 정상 작동 (/api/survey/submit)
- [x] department_scores 테이블 업데이트 확인 (본인 소속 조직 19개 문항)
- [x] other_dept_scores 테이블 업데이트 확인 (간부만, 5개 문항 × 9개 부서)
- [x] management_scores 테이블 업데이트 확인 (5점척도 22개 문항)
- [x] text_responses 테이블 저장 확인 (관리처 서술형 2개 + 종합 의견 4개)
- [x] has_completed 플래그 업데이트 확인
- [x] 완료 페이지 렌더링 (/survey/completed)
- [x] 완료 페이지에서 로그아웃 기능 작동

**테스트 결과**: 모든 시나리오 통과 ✅ (2025-10-22)

### Phase 6: 전체 현황 대시보드 테스트 ✅ (2025-10-22 완료)

**테스트 URL**: http://localhost:3000/admin/dashboard

**시나리오 1: 관리자 로그인 및 대시보드 접근**
- [x] 관리자 계정 로그인 (admin / admin1234)
- [x] /admin/dashboard로 자동 리다이렉트
- [x] 대시보드 페이지 렌더링

**시나리오 2: 전체 응답 현황**
- [x] 전체 대상 카드 표시 (15명)
- [x] 응답 완료 카드 표시 (2명)
- [x] 응답률 카드 표시 (13.3%)

**시나리오 3: 부서별 응답 현황**
- [x] 부서별 응답 현황 테이블 렌더링
- [x] 10개 부서 모두 표시
- [x] 전체/완료/응답률 표시
- [x] 상세 분석 링크 10개 모두 작동

**시나리오 4: 메뉴 네비게이션**
- [x] 관리처 전반 분석 링크
- [x] 전체 순위 링크
- [x] 로그아웃 링크

**테스트 결과**: 모든 시나리오 통과 ✅

### Phase 7: 부서별 분석 페이지 테스트 ✅ (2025-10-22 완료)

**테스트 URL**: http://localhost:3000/admin/department/전자제어부

**시나리오 1: 페이지 렌더링**
- [x] 부서명 표시 (전자제어부 분석)
- [x] 대시보드로 돌아가기 링크

**시나리오 2: 레이더 차트**
- [x] 레이더 차트 렌더링
- [x] 본인평가/최종점수 두 개 데이터셋
- [x] 4개 평가유형 표시

**시나리오 3: 평가유형별 상세 점수**
- [x] 상세 점수 테이블 렌더링
- [x] 본인평가, 타부서평가, 최종점수 표시
- [x] 차이값 표시 (색상 구분)
- [x] 순위 표시

**시나리오 4: AI 분석**
- [x] AI 분석 섹션 렌더링
- [x] AI 분석 생성 버튼 표시

**테스트 결과**: 모든 시나리오 통과 ✅

### Phase 8: AI 종합평가 테스트 ✅ (2025-10-22 완료)

**기능 확인**
- [x] OpenAI GPT-4 연동 코드 작성
- [x] 부서별 분석 프롬프트 작성
- [x] 관리처 분석 프롬프트 작성
- [x] AIAnalysis 컴포넌트 구현
- [x] react-markdown 패키지 설치

**테스트 결과**: 구현 완료 ✅

### Phase 9: 관리처 분석 페이지 테스트 ✅ (2025-10-22 완료)

**테스트 URL**: http://localhost:3000/admin/management

**시나리오 1: 페이지 렌더링**
- [x] 관리처 전반 분석 타이틀 표시
- [x] 대시보드로 돌아가기 링크

**시나리오 2: 레이더 차트**
- [x] 레이더 차트 렌더링
- [x] 4개 평가유형 평균 점수 표시

**시나리오 3: 평가유형별 평균 점수**
- [x] 평가유형별 테이블 렌더링
- [x] 평균 점수 표시
- [x] 응답 수 표시

**시나리오 4: 세부 문항별 점수**
- [x] 평가유형별 그룹화
- [x] 문항별 점수 표시

**시나리오 5: 서술형 응답 키워드 분석**
- [x] 6개 서술형 문항 섹션 렌더링
- [x] 워드클라우드 영역 표시
- [x] 응답 없음 메시지 표시

**시나리오 6: AI 분석**
- [x] AI 분석 섹션 렌더링
- [x] AI 분석 생성 버튼 표시

**테스트 결과**: 모든 시나리오 통과 ✅

### Phase 10: 전체 순위 페이지 테스트 ✅ (2025-10-22 완료)

**테스트 URL**: http://localhost:3000/admin/ranking

**시나리오 1: 페이지 렌더링**
- [x] 전체 순위 타이틀 표시
- [x] 대시보드로 돌아가기 링크

**시나리오 2: 부서별 종합 순위 차트**
- [x] 바 차트 렌더링
- [x] 10개 부서 모두 표시
- [x] 순위별 색상 구분

**시나리오 3: 종합 순위 상세 테이블**
- [x] 순위 테이블 렌더링
- [x] 1-3위 메달 색상 표시
- [x] 부서명, 평균 점수 표시
- [x] 상세 분석 링크 작동

**시나리오 4: 평가유형별 순위 차트**
- [x] 조직문화 순위 차트
- [x] 업무충실 순위 차트
- [x] 업무협조 순위 차트
- [x] 업무혁신 순위 차트

**테스트 결과**: 모든 시나리오 통과 ✅

### Phase 6-10: 관리자 대시보드 테스트 (미구현)

**시나리오 1: 관리자 로그인**
- [ ] 관리자 계정으로 로그인
- [ ] 대시보드 페이지 접근

**시나리오 2: 응답 현황**
- [ ] 전체 응답률 표시
- [ ] 부서별 응답률 표시

**시나리오 3: 부서별 분석**
- [ ] 레이더 차트 렌더링
- [ ] 점수 테이블 표시
- [ ] AI 분석 생성

**시나리오 4: 관리처 분석**
- [ ] 레이더 차트 렌더링
- [ ] 워드클라우드 렌더링

**시나리오 5: 전체 순위**
- [ ] 부서별 순위 차트 렌더링

## 테스트 실패 시 처리

1. **오류 로그 확인**: 콘솔 에러 메시지 분석
2. **코드 수정**: 발견된 문제 수정
3. **재테스트**: 수정 후 다시 테스트 실행
4. **반복**: 모든 테스트 통과까지 반복

## 테스트 전 준비사항

### 개발 서버 실행
```bash
cd /Users/jsk/1021/survey-app
npm run dev
```

### 테스트 계정 생성 (최초 1회)
```bash
cd /Users/jsk/1021/survey-app
npm run create-users
```

생성되는 계정:
- 관리자: `admin` / `admin1234`
- 직원: `지역협력부_직원` / `test1234` (10개 부서)
- 간부: `간부1` ~ `간부5` / `test1234`

## 현재 Phase 상태

- [x] Phase 0: 문서화 및 계획
- [x] Phase 1: 기반 구축 (80% - RLS 제외)
- [x] Phase 2: Next.js 프로젝트 초기화
- [x] Phase 3: 인증 시스템 ✅ **테스트 완료**
- [x] Phase 4: 설문 시스템 ✅ **테스트 완료 (2025-10-22)**
- [x] Phase 5: 점수 계산 엔진 ✅ **구현 완료 (2025-10-22)**
- [x] Phase 6: 전체 현황 대시보드 ✅ **구현 완료 (2025-10-22)**
- [x] Phase 7: 부서별 분석 페이지 ✅ **구현 완료 (2025-10-22)**
- [x] Phase 8: AI 종합평가 ✅ **구현 완료 (2025-10-22)**
- [x] Phase 9: 관리처 분석 페이지 ✅ **구현 완료 (2025-10-22)**
- [x] Phase 10: 전체 순위 페이지 ✅ **구현 완료 (2025-10-22)**
- [ ] Phase 11: UI/UX 개선 ← **다음 작업**
- [ ] Phase 12: 테스트
- [ ] Phase 13: 배포

## 다음 작업

1. ~~Phase 3 Playwright 테스트 실행~~ ✅
2. ~~테스트 통과 확인~~ ✅
3. ~~Phase 4 설문 시스템 구현~~ ✅
4. ~~Phase 5 점수 계산 엔진 구현~~ ✅
5. ~~Phase 6-10 관리자 대시보드 구현~~ ✅
6. Phase 11 UI/UX 개선 ← **현재 작업**
